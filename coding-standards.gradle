/**
 * ç¼–ç è§„èŒƒç»Ÿä¸€é…ç½®æ–‡ä»¶
 *
 * ä½œè€…: kk
 * åˆ›å»ºæ—¥æœŸ: 2025-10-01
 * è¯´æ˜: æ•´åˆæ‰€æœ‰ç¼–ç è§„èŒƒæ£€æŸ¥ï¼Œæä¾›ç»Ÿä¸€çš„æ£€æŸ¥å…¥å£
 *
 * ä½¿ç”¨æ–¹å¼:
 * 1. åœ¨é¡¹ç›®çš„build.gradleä¸­æ·»åŠ : apply from: 'coding-standards-gradle/coding-standards.gradle'
 * 2. è¿è¡Œæ£€æŸ¥: gradle checkCodingStandards
 * 3. ç¼–è¯‘æ—¶è‡ªåŠ¨æ£€æŸ¥: gradle compileJava (ä¼šè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰å¼ºåˆ¶æ€§æ£€æŸ¥)
 */

println "="*60
println "  SBT Plus ç¼–ç è§„èŒƒæ£€æŸ¥å·¥å…·"
println "  ä½œè€…: kk"
println "  ç‰ˆæœ¬: 1.0.0"
println "="*60

// åŠ è½½æ‰€æœ‰è§„èŒƒæ¨¡å—
apply from: 'coding-standards-gradle/common-coding.gradle'
apply from: 'coding-standards-gradle/database-standards.gradle'
apply from: 'coding-standards-gradle/java-coding-standards.gradle'
apply from: 'coding-standards-gradle/mybatis-flex-standards.gradle'

// ç»Ÿä¸€æ£€æŸ¥ä»»åŠ¡
tasks.register('checkCodingStandards') {
    group = 'verification'
    description = 'æ‰§è¡Œæ‰€æœ‰ç¼–ç è§„èŒƒæ£€æŸ¥ï¼ˆåŒ…æ‹¬å¼ºåˆ¶æ€§å’Œå»ºè®®æ€§ï¼‰'

    // é€šç”¨ç¼–ç è§„èŒƒ
    dependsOn 'checkCommonCodingStandards'

    // æ•°æ®åº“è§„èŒƒ
    dependsOn 'checkDatabaseStandards'

    // Javaç¼–ç è§„èŒƒ
    dependsOn 'checkJavaCodingStandards'

    // MyBatis-Flexè§„èŒƒ
    dependsOn 'checkMyBatisFlexStandards'

    doLast {
        println "\n" + "="*60
        println "âœ… æ‰€æœ‰ç¼–ç è§„èŒƒæ£€æŸ¥å®Œæˆï¼"
        println "="*60 + "\n"
    }
}

// å¼ºåˆ¶æ€§æ£€æŸ¥ä»»åŠ¡ï¼ˆç¼–è¯‘å‰å¿…é¡»é€šè¿‡ï¼‰
// æ³¨æ„ï¼šè¿™ä¸ªä»»åŠ¡å®šä¹‰åœ¨æ ¹é¡¹ç›®ï¼Œä¸èƒ½ç›´æ¥ä¾èµ–å­é¡¹ç›®çš„validateVoTypesä»»åŠ¡
// validateVoTypesä¼šåœ¨å­é¡¹ç›®çš„compileJavaä¸­å•ç‹¬æ‰§è¡Œ
tasks.register('checkMandatoryStandards') {
    group = 'verification'
    description = 'æ‰§è¡Œå¼ºåˆ¶æ€§ç¼–ç è§„èŒƒæ£€æŸ¥ï¼ˆç¼–è¯‘å‰å¿…é¡»é€šè¿‡ï¼‰'

    // å¼ºåˆ¶æ€§æ£€æŸ¥åˆ—è¡¨ï¼ˆä»…åŒ…å«æ ¹é¡¹ç›®çº§åˆ«çš„æ£€æŸ¥ï¼‰
    dependsOn 'checkFullyQualifiedNames'          // ç¦æ­¢å…¨é™å®šç±»å
    dependsOn 'checkLongConstantSuffix'           // Longå¸¸é‡åç¼€
    dependsOn 'checkSelectStar'                   // ç¦æ­¢SELECT *
    dependsOn 'checkEntityRequiredFields'         // Entityå¿…å¤‡å­—æ®µ
    dependsOn 'checkAmountFieldType'              // é‡‘é¢å­—æ®µç±»å‹
    dependsOn 'checkEnumNaming'                   // æšä¸¾ç±»å‘½å
    dependsOn 'checkResultPageResultNesting'      // Result/PageResultåµŒå¥—
    dependsOn 'checkEntityAnnotations'            // Entityæ³¨è§£
    dependsOn 'checkMapperInterface'              // Mapperæ¥å£
    dependsOn 'checkLogicDeleteField'             // é€»è¾‘åˆ é™¤å­—æ®µ
    dependsOn 'checkVersionField'                 // ä¹è§‚é”ç‰ˆæœ¬å·å­—æ®µ

    doLast {
        println "\n" + "="*60
        println "âœ… å¼ºåˆ¶æ€§ç¼–ç è§„èŒƒæ£€æŸ¥é€šè¿‡ï¼"
        println "="*60 + "\n"
    }
}

// å»ºè®®æ€§æ£€æŸ¥ä»»åŠ¡ï¼ˆä»…è­¦å‘Šï¼Œä¸ä¸­æ–­ç¼–è¯‘ï¼‰
tasks.register('checkAdvisoryStandards') {
    group = 'verification'
    description = 'æ‰§è¡Œå»ºè®®æ€§ç¼–ç è§„èŒƒæ£€æŸ¥ï¼ˆä»…è­¦å‘Šï¼Œä¸ä¸­æ–­ç¼–è¯‘ï¼‰'

    // å»ºè®®æ€§æ£€æŸ¥åˆ—è¡¨
    dependsOn 'checkMagicValues'                  // é­”æ³•å€¼æ£€æŸ¥
    dependsOn 'checkCollectionEmpty'              // é›†åˆåˆ¤ç©º
    dependsOn 'checkIndexNaming'                  // ç´¢å¼•å‘½åè§„èŒƒ
    dependsOn 'checkClassNaming'                  // ç±»å‘½åè§„èŒƒ
    dependsOn 'checkLombokAnnotations'            // Lombokæ³¨è§£
    dependsOn 'checkRecordUsage'                  // Recordç±»ä½¿ç”¨
    dependsOn 'checkEnumFromCodeMethod'           // æšä¸¾fromCodeæ–¹æ³•
    dependsOn 'checkEnumValueAnnotation'          // æšä¸¾@EnumValueæ³¨è§£
    dependsOn 'checkTimeFieldAutoFill'            // æ—¶é—´å­—æ®µè‡ªåŠ¨å¡«å……

    doLast {
        println "\n" + "="*60
        println "ğŸ’¡ å»ºè®®æ€§ç¼–ç è§„èŒƒæ£€æŸ¥å®Œæˆï¼ˆä»¥ä¸Šè­¦å‘Šä¸å½±å“ç¼–è¯‘ï¼‰"
        println "="*60 + "\n"
    }
}

// æ³¨æ„ï¼šä¸åœ¨æ ¹é¡¹ç›®çº§åˆ«å°†checkMandatoryStandardsé›†æˆåˆ°compileJava
// å› ä¸ºvalidateVoTypesä»»åŠ¡åœ¨å­é¡¹ç›®ä¸­å®šä¹‰ï¼Œä¼šåœ¨å­é¡¹ç›®çš„compileJavaä¸­è‡ªåŠ¨æ‰§è¡Œ
// ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ gradle checkMandatoryStandards æ¥è¿è¡Œæ‰€æœ‰å¼ºåˆ¶æ€§æ£€æŸ¥

// ç”Ÿæˆæ£€æŸ¥æŠ¥å‘Š
tasks.register('generateCodingStandardsReport') {
    group = 'verification'
    description = 'ç”Ÿæˆç¼–ç è§„èŒƒæ£€æŸ¥æŠ¥å‘Š'

    doLast {
        def reportDir = file("${project.buildDir}/reports/coding-standards")
        reportDir.mkdirs()

        def reportFile = new File(reportDir, "coding-standards-report.md")
        def timestamp = new Date().format('yyyy-MM-dd HH:mm:ss')

        reportFile.text = """# ç¼–ç è§„èŒƒæ£€æŸ¥æŠ¥å‘Š

**é¡¹ç›®**: ${project.name}
**ç”Ÿæˆæ—¶é—´**: ${timestamp}

---

## æ£€æŸ¥è§„åˆ™æ¦‚è§ˆ

### å¼ºåˆ¶æ€§æ£€æŸ¥ï¼ˆç¼–è¯‘æ—¶æ‰§è¡Œï¼‰
1. âœ“ ç¦æ­¢å…¨é™å®šç±»åæ£€æŸ¥
2. âœ“ Longå¸¸é‡åç¼€æ£€æŸ¥ï¼ˆå¿…é¡»ä½¿ç”¨å¤§å†™Lï¼‰
3. âœ“ ç¦æ­¢SELECT * æ£€æŸ¥
4. âœ“ Entityå¿…å¤‡å­—æ®µæ£€æŸ¥ï¼ˆid/createTime/updateTime/isDeletedï¼‰
5. âœ“ é‡‘é¢å­—æ®µç±»å‹æ£€æŸ¥ï¼ˆå¿…é¡»ä½¿ç”¨BigDecimalï¼‰
6. âœ“ æšä¸¾ç±»å‘½åæ£€æŸ¥ï¼ˆå¿…é¡»ä»¥Enumç»“å°¾ï¼‰
7. âœ“ Result/PageResultåµŒå¥—æ£€æŸ¥
8. âœ“ Entityæ³¨è§£æ£€æŸ¥ï¼ˆ@Table/@Idï¼‰
9. âœ“ Mapperæ¥å£æ£€æŸ¥ï¼ˆç»§æ‰¿BaseMapperï¼‰
10. âœ“ é€»è¾‘åˆ é™¤å­—æ®µæ£€æŸ¥
11. âœ“ ä¹è§‚é”ç‰ˆæœ¬å·å­—æ®µæ£€æŸ¥

### å»ºè®®æ€§æ£€æŸ¥ï¼ˆä»…è­¦å‘Šï¼‰
1. âš  é­”æ³•å€¼æ£€æŸ¥
2. âš  é›†åˆåˆ¤ç©ºæ–¹æ³•æ£€æŸ¥
3. âš  ç´¢å¼•å‘½åè§„èŒƒæ£€æŸ¥
4. âš  ç±»å‘½åè§„èŒƒæ£€æŸ¥
5. âš  Lombokæ³¨è§£ä½¿ç”¨æ£€æŸ¥
6. âš  Recordç±»ä½¿ç”¨å»ºè®®
7. âš  æšä¸¾fromCodeæ–¹æ³•æ£€æŸ¥
8. âš  æšä¸¾@EnumValueæ³¨è§£æ£€æŸ¥
9. âš  æ—¶é—´å­—æ®µè‡ªåŠ¨å¡«å……æ£€æŸ¥

---

## ä½¿ç”¨è¯´æ˜

### æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥
```bash
gradle checkCodingStandards
```

### ä»…æ‰§è¡Œå¼ºåˆ¶æ€§æ£€æŸ¥
```bash
gradle checkMandatoryStandards
```

### ä»…æ‰§è¡Œå»ºè®®æ€§æ£€æŸ¥
```bash
gradle checkAdvisoryStandards
```

### æ‰§è¡Œç‰¹å®šæ¨¡å—æ£€æŸ¥
```bash
gradle checkCommonCodingStandards     # é€šç”¨ç¼–ç è§„èŒƒ
gradle checkDatabaseStandards         # æ•°æ®åº“è§„èŒƒ
gradle checkJavaCodingStandards       # Javaç¼–ç è§„èŒƒ
gradle checkMyBatisFlexStandards      # MyBatis-Flexè§„èŒƒ
```

---

## è§„èŒƒæ–‡æ¡£
- [é€šç”¨ç¼–ç è§„èŒƒ](~/.claude/coding-standards/common-coding.md)
- [æ•°æ®åº“è§„èŒƒ](~/.claude/coding-standards/database-standards.md)
- [Javaç¼–ç è§„èŒƒ](~/.claude/coding-standards/java-coding-standards.md)
- [MyBatis-Flexè§„èŒƒ](~/.claude/coding-standards/mybatis-flex-standards.md)

---

**æŠ¥å‘Šç”Ÿæˆäº**: ${timestamp}
"""

        println "\n" + "="*60
        println "ğŸ“„ ç¼–ç è§„èŒƒæ£€æŸ¥æŠ¥å‘Šå·²ç”Ÿæˆ:"
        println "   ${reportFile.absolutePath}"
        println "="*60 + "\n"
    }
}

// å¸®åŠ©ä¿¡æ¯
tasks.register('codingStandardsHelp') {
    group = 'help'
    description = 'æ˜¾ç¤ºç¼–ç è§„èŒƒæ£€æŸ¥å·¥å…·çš„ä½¿ç”¨å¸®åŠ©'

    doLast {
        println """
${"="*60}
  SBT Plus ç¼–ç è§„èŒƒæ£€æŸ¥å·¥å…· - ä½¿ç”¨å¸®åŠ©
${"="*60}

ã€æ ¸å¿ƒæ£€æŸ¥ä»»åŠ¡ã€‘
  gradle checkCodingStandards         æ‰§è¡Œæ‰€æœ‰ç¼–ç è§„èŒƒæ£€æŸ¥
  gradle checkMandatoryStandards      æ‰§è¡Œå¼ºåˆ¶æ€§æ£€æŸ¥ï¼ˆç¼–è¯‘å‰å¿…é¡»é€šè¿‡ï¼‰
  gradle checkAdvisoryStandards       æ‰§è¡Œå»ºè®®æ€§æ£€æŸ¥ï¼ˆä»…è­¦å‘Šï¼‰

ã€åˆ†æ¨¡å—æ£€æŸ¥ã€‘
  gradle checkCommonCodingStandards   é€šç”¨ç¼–ç è§„èŒƒæ£€æŸ¥
  gradle checkDatabaseStandards       æ•°æ®åº“è§„èŒƒæ£€æŸ¥
  gradle checkJavaCodingStandards     Javaç¼–ç è§„èŒƒæ£€æŸ¥
  gradle checkMyBatisFlexStandards    MyBatis-Flexè§„èŒƒæ£€æŸ¥

ã€å…·ä½“æ£€æŸ¥é¡¹ã€‘
  é€šç”¨ç¼–ç :
    - checkFullyQualifiedNames        ç¦æ­¢å…¨é™å®šç±»å
    - checkMagicValues                é­”æ³•å€¼æ£€æŸ¥
    - checkLongConstantSuffix         Longå¸¸é‡åç¼€
    - checkCollectionEmpty            é›†åˆåˆ¤ç©º

  æ•°æ®åº“:
    - checkSelectStar                 ç¦æ­¢SELECT *
    - checkEntityRequiredFields       Entityå¿…å¤‡å­—æ®µ
    - checkIndexNaming                ç´¢å¼•å‘½åè§„èŒƒ
    - checkAmountFieldType            é‡‘é¢å­—æ®µç±»å‹

  Javaç¼–ç :
    - checkEnumNaming                 æšä¸¾ç±»å‘½å
    - checkClassNaming                ç±»å‘½åè§„èŒƒ
    - checkLombokAnnotations          Lombokæ³¨è§£
    - checkResultPageResultNesting    Result/PageResultåµŒå¥—
    - checkRecordUsage                Recordç±»ä½¿ç”¨
    - checkEnumFromCodeMethod         æšä¸¾fromCodeæ–¹æ³•

  MyBatis-Flex:
    - checkEntityAnnotations          Entityæ³¨è§£
    - checkMapperInterface            Mapperæ¥å£
    - checkEnumValueAnnotation        æšä¸¾@EnumValueæ³¨è§£
    - checkLogicDeleteField           é€»è¾‘åˆ é™¤å­—æ®µ
    - checkVersionField               ä¹è§‚é”ç‰ˆæœ¬å·å­—æ®µ
    - checkTimeFieldAutoFill          æ—¶é—´å­—æ®µè‡ªåŠ¨å¡«å……

ã€æŠ¥å‘Šç”Ÿæˆã€‘
  gradle generateCodingStandardsReport  ç”Ÿæˆæ£€æŸ¥æŠ¥å‘Š

ã€è‡ªåŠ¨æ‰§è¡Œã€‘
  ç¼–è¯‘æ—¶è‡ªåŠ¨æ‰§è¡Œå¼ºåˆ¶æ€§æ£€æŸ¥:
    gradle compileJava                ä¼šè‡ªåŠ¨æ‰§è¡ŒcheckMandatoryStandards

${"="*60}
è§„èŒƒæ–‡æ¡£è·¯å¾„: ~/.claude/coding-standards/
${"="*60}
        """
    }
}

println """
å·²åŠ è½½ç¼–ç è§„èŒƒæ¨¡å—:
  âœ“ common-coding.gradle          é€šç”¨ç¼–ç è§„èŒƒ
  âœ“ database-standards.gradle     æ•°æ®åº“è§„èŒƒ
  âœ“ java-coding-standards.gradle  Javaç¼–ç è§„èŒƒ
  âœ“ mybatis-flex-standards.gradle MyBatis-Flexè§„èŒƒ

æ‰§è¡Œ 'gradle codingStandardsHelp' æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©
${"="*60}
"""
